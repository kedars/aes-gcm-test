<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebCrypto API Demo: AES-GCM</title>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript">

    function AES_GCM_encrypt()
    {
        var keyData = hexStringToUint8Array(document.getElementById("gcm_key").value);
        var iv = hexStringToUint8Array(document.getElementById("gcm_iv").value);
        crypto.subtle.importKey("raw", keyData, "aes-gcm", false, ["encrypt"]).then(function(key) {
            var plainText = document.getElementById("plainTextGCM").value;
            return crypto.subtle.encrypt({name: "aes-gcm", iv: iv}, key, hexStringToUint8Array(plainText));
        }, failAndLog).then(function(cipherText) {
            document.getElementById("cipherTextGCM").value = bytesToHexString(cipherText);
        }, failAndLog);
    }
    function AES_GCM_decrypt()
    {
        var keyData = hexStringToUint8Array(document.getElementById("gcm_key").value);
        var iv = hexStringToUint8Array(document.getElementById("gcm_iv").value);
        crypto.subtle.importKey("raw", keyData, "aes-gcm", false, ["decrypt"]).then(function(key) {
            var cipherText = document.getElementById("cipherTextGCM").value;
            return crypto.subtle.decrypt({name: "aes-gcm", iv: iv}, key, hexStringToUint8Array(cipherText));
        }, failAndLog).then(function(plainText) {
            document.getElementById("resultGCM").innerHTML = "Result: " + bytesToHexString(plainText);
        }, function(result) {
            document.getElementById("resultGCM").innerHTML = "Result: " + result;
        });
    }
    </script>
</head>
<body>
    <h1>AES-GCM</h1>
    <p>Click the corresponding buttons to do AES-CBC/GCM encryption/decryption. In the middle, try to modify the cipher text to see how AES-CBC/GCM responds.</p>
    <div>
        Key: <input type="text" id="gcm_key" size="70" value="2b7e151628aed2a6abf7158809cf4f3c2b7e151628aed2a6abf7158809cf4f3c">
        IV: <input type="text" id="gcm_iv" size="30" value="000102030405060708090a0b0c0d0e0f">
    </div>
    <div>
        Plain Text (hex string): <input type="text" id="plainTextGCM" value="Hello, World!" size="100">
        <button type="button" onclick="AES_GCM_encrypt()">encryptGCM</button>
    </div>
    <div>
        Cipher Text (hex string) {Last 32-hex characters are Tag}: <input type="text" id="cipherTextGCM" size="100">
        <button type="button" onclick="AES_GCM_decrypt()">decryptGCM</button>
    </div>
    <div id="resultGCM">
        Result:
    </div>
</body>
</html>
